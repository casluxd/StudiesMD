Há muitas situações em que a transferência de arquivos de ou para um sistema de destino é necessária. Vamos imaginar o seguinte cenário:

## Definindo o estágio

```
Durante um trabalho, obtemos execução remota de código ( RCE ) em um servidor da Web IIS por meio de uma vulnerabilidade irrestrita de upload de arquivos. Carregamos um shell da Web inicialmente e depois enviamos um shell reverso para enumerar ainda mais o sistema, na tentativa de aumentar os privilégios. Tentamos usar o PowerShell para transferir [PowerUp.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1) ( um script PowerShell para enumerar vetores de escalonamento de privilégios ), mas o PowerShell é bloqueado pelo [Política de Controle de Aplicativos](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/windows-defender-application-control). Realizamos nossa enumeração local manualmente e descobrimos que temos [SeImpersonatePrivilege](https://docs.microsoft.com/en-us/troubleshoot/windows-server/windows-security/seimpersonateprivilege-secreateglobalprivilege). Precisamos transferir um binário para nossa máquina de destino para aumentar os privilégios usando a ferramenta [PrintSpoofer](https://github.com/itm4n/PrintSpoofer). Tentamos então usar [Certutil](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil) para baixar o arquivo, nos compilamos diretamente do nosso próprio GitHub, mas a organização possui uma forte filtragem de conteúdo da web. Não podemos acessar sites como GitHub, Dropbox, Google Drive etc. que podem ser usados para transferir arquivos. Em seguida, configuramos um servidor FTP e tentamos usar o cliente FTP do Windows para transferir arquivos, mas o firewall da rede bloqueou o tráfego de saída da porta 21 ( TCP ). Tentamos usar a ferramenta [Impacotador smbserver](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbserver.py) para criar uma pasta e descobrimos que o tráfego de saída para a porta TCP 445 ( SMB ) era permitido. Usamos esse método de transferência de arquivos para copiar com êxito o binário em nossa máquina de destino e atingir nosso objetivo de aumentar privilégios para um usuário no nível de administrador.
```

Compreender diferentes maneiras de executar transferências de arquivos e como as redes operam pode nos ajudar a atingir nossos objetivos durante uma avaliação. Devemos estar cientes dos controles do host que podem impedir nossas ações, como lista de permissões de aplicativos ou AV / EDR bloqueando aplicativos ou atividades específicas. As transferências de arquivos também são afetadas por dispositivos de rede, como Firewalls, IDS ou IPS, que podem monitorar ou bloquear portas específicas ou operações incomuns.

A transferência de arquivos é um recurso essencial de qualquer sistema operacional e existem muitas ferramentas para isso. No entanto, muitas dessas ferramentas podem ser bloqueadas ou monitoradas por administradores diligentes, e vale a pena revisar uma variedade de técnicas que podem ser possíveis em um determinado ambiente.

Este módulo abrange técnicas que alavancam ferramentas e aplicativos comumente disponíveis em sistemas Windows e Linux. A lista de técnicas não é exaustiva. As informações contidas neste módulo também podem ser usadas como um guia de referência ao trabalhar em outros módulos da HTB Academy, pois muitos dos exercícios no módulo exigirão a transferência de arquivos para/de um host de destino ou de / para o Pwnbox fornecido. Máquinas alvo para Windows e Linux são fornecidas para concluir alguns exercícios práticos como parte do módulo. Vale a pena utilizar esses alvos para experimentar o maior número possível de técnicas demonstradas nas seções do módulo. Observe as nuances entre os diferentes métodos de transferência e anote situações em que elas seriam úteis. Depois de concluir este módulo,experimente as várias técnicas em outros módulos e caixas e laboratórios da HTB Academy na plataforma principal HTB.