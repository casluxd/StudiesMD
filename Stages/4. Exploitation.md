
Durante o estágio de Exploração, procuramos maneiras de adaptar essas fraquezas ao nosso caso de uso para obter a função desejada (ou seja, uma base de apoio, privilégios escalados etc.). Se quisermos obter um shell reverso, precisamos modificar o PoC para executar o código, para que o sistema de destino se conecte de volta a nós (idealmente) por uma conexão criptografada a um endereço IP que especificamos. Portanto, a preparação de um exploit é principalmente parte do estágio de Exploração.

![[Pasted image 20230613190914.png]]

Esses estágios não devem ser estritamente separados uns dos outros, pois estão intimamente conectados. No entanto, ainda é importante distinguir em que fase estamos e seu propósito. Porque depois, com processos muito mais complexos e muito mais informações, é muito fácil perder a noção dos passos que foram dados, principalmente se o teste de penetração durar várias semanas e abranger um escopo massivo.

## Prioritization of Possible Attacks

Depois de encontrar uma ou duas vulnerabilidades durante o estágio de avaliação de vulnerabilidades que podemos aplicar à nossa rede/sistema de destino, podemos priorizar esses ataques. Qual desses ataques priorizamos mais do que os outros depende dos seguintes fatores:
- Probabilidade de Sucesso
- Complexidade
- Probabilidade de Dano

Primeiro, precisamos avaliar a probabilidade de executar com sucesso um determinado ataque contra o alvo. O CVSS Scoring pode nos ajudar aqui, usando a calculadora NVD para calcular melhor os ataques específicos e sua probabilidade de sucesso.

Complexidade representa o esforço de explorar uma vulnerabilidade específica. Isso é usado para estimar quanto tempo, esforço e pesquisa são necessários para executar o ataque ao sistema com sucesso. Nossa experiência desempenha um papel importante aqui, porque se vamos realizar um ataque que nunca usamos antes, isso exigirá logicamente muito mais pesquisa e esforço, pois devemos entender o ataque e a estrutura de exploração em detalhes antes de aplicá-lo.

Estimar a probabilidade de dano causado pela execução de um exploit desempenha um papel crítico, pois devemos evitar qualquer dano aos sistemas de destino. Geralmente, não executamos ataques DoS, a menos que nosso cliente os exija. No entanto, atacar os serviços em execução ao vivo com exploits que podem causar danos ao software ou ao sistema operacional é algo que devemos evitar em todos os momentos.

Além disso, podemos atribuir esses fatores a um sistema de pontuação pessoal que permitirá que a avaliação seja calculada com mais precisão com base em nossas habilidades e conhecimentos:

#### Prioritization Example

|**Factor**|**Points**|**Remote File Inclusion**|**Buffer Overflow**|
|---|---|---|---|
|1. Probability of Success|`10`|10|8|
|2. Complexity - Easy|`5`|4|0|
|3. Complexity - Medium|`3`|0|3|
|4. Complexity - Hard|`1`|0|0|
|5. Probability of Damage|`-5`|0|-5|
|**Summary**|`max. 15`|14|6|

Com base no exemplo acima, preferimos o ataque de inclusão de arquivo remoto. É fácil de preparar e executar e não deve causar danos se for abordado com cuidado.

## Preparation for the Attack

Às vezes, nos deparamos com uma situação em que não conseguimos encontrar um código de exploração de PoC de alta qualidade e conhecido. Portanto, pode ser necessário reconstruir a exploração localmente em uma VM que representa nosso host de destino para descobrir com precisão o que precisa ser adaptado e alterado. Depois de configurar o sistema localmente e instalar componentes conhecidos para espelhar o ambiente de destino o mais próximo possível (ou seja, mesmos números de versão para serviços/aplicativos de destino), podemos começar a preparar o exploit seguindo as etapas descritas no exploit. Em seguida, testamos isso em uma VM hospedada localmente para garantir que funcione e não danifique significativamente. Em outras situações, encontraremos configurações incorretas e vulnerabilidades que vemos com muita frequência e sabemos exatamente qual ferramenta ou exploração usar e se a exploração ou técnica é "segura" ou pode causar instabilidade.

Em caso de dúvida antes de executar um ataque, é sempre melhor verificar com nosso cliente, fornecendo-lhe todos os dados necessários para que ele possa tomar uma decisão informada sobre se deseja que tentemos a exploração ou apenas marque a descoberta como um problema. Se eles optarem por não prosseguirmos com a exploração, podemos observar no relatório que isso não foi confirmado ativamente, mas provavelmente é um problema que precisa ser resolvido. Temos uma certa margem de manobra durante os testes de penetração e sempre devemos usar nosso melhor julgamento se um determinado ataque parecer muito arriscado ou puder causar uma interrupção. Na dúvida, comunique-se. O líder/gerente de sua equipe, o cliente, quase certamente preferirá uma comunicação extra do que se deparar com uma situação em que está tentando colocar um sistema online novamente após uma tentativa de exploração fracassada.

Depois de explorar um alvo com sucesso e ter acesso inicial (e fazer anotações claras para nossos relatórios e registrar todas as atividades em nosso registro de atividades!), passaremos para as etapas de pós-exploração e movimento lateral.